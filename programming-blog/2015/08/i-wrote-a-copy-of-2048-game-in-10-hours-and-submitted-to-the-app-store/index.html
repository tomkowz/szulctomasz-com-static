<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>I wrote a copy of 2048 game in 10 hours and submitted to the App Store - Tomasz Szulc</title>

	
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="iOS Software Engineer. Personal site, programming blog and more." />
<meta name="author" content="Tomasz Szulc" />
<meta name="keywords" content="developer, ios, programming, mobile, apps" />

	
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="I wrote a copy of 2048 game in 10 hours and submitted to the App Store" />
    <meta property="og:description" content="That was pretty effective Saturday. Writing game was an interesting process and I played a lot 2048 that day. Here are my thoughts and impressions." />

    

    <meta property="article:published_time" content="2015-08-04 19:00:00 &#43;0000 UTC" />
    <meta property="article:tag" content="programming, ios, swift" />
    
    



	
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Karla" />
<link rel="stylesheet" href="/css/style.css" />

	
<link rel="shortcut icon" type="image/jpg" href="/img/favicon.jpg"/ />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/ />
<link rel ="icon" type="image/jpg" href="/img/favicon.jpg"/ />

	<meta name="generator" content="Hugo 0.37.1" />

	<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-4112786-17', 'auto');
    ga('send', 'pageview');
</script>
</head>
<body>
	<main id="main-container" class= "width-default">

<div id="top-header">
    <img id="avatar" src="/img/rounded-avatar.png">
    <ul>
        <li><a href="/programming-blog">blog</a></li>
        <li><a href="/">about</a></li>
        
    </ul>
</div>
    <article>
        <h1>I wrote a copy of 2048 game in 10 hours and submitted to the App Store</h1>
        <p>

<p><strong>Important notice 1:</strong> The code presented here has been written in Swift 1.2 which is no longer supported.</p>

<p><strong>Important notice 2:</strong> Except of that App is no longer in the store because I haven&rsquo;t time to maintain it, the rest of the article is valid. Keep reading :)</p>

<p>&ndash;</p>

<p>That was pretty effective Saturday. Writing game was an interesting process and
I played a lot 2048 that day. Here are my thoughts and impressions.</p>

<p>I spoke with my colleague about his job interview challenge he got from one of
employers from California and it was about writing 2048 game. Actually two guys
did it, one in 8 hours and my colleague in 17 hours - both with different
approaches in Objective-C.</p>

<p>I got inspired. The challenge might be good opportunity to check my Swift skills
and to make me more confident about it, because <em>I am thinking about relocating
from Poland to San Francisco Bay Area next year and will be searching for a
job - Want to help me? Or Hire?</em> :)</p>

<p>Anyway, I decided to spend Saturday working on the app. But on entire app, not
just a module to play like in the original challenge. And I planned to do it in
Swift because I&rsquo;m in love with Swift these days and wanted to examine my
Swift skills :)</p>

<p>I did it in Swift 1.2 and Xcode 6.4 to be able to submit the app to the store.</p>

<h3 id="repository-and-the-app">Repository and the app</h3>

<p>The project is <a href="https://github.com/tomkowz/2048">available on GitHub</a>. Feel free to contribute if you find
something that is worth to change/improve. I am always open to new ideas.</p>

<p>You can find the app on the App Store - <a href="https://itunes.apple.com/us/app/2048-flat-color-version/id1023137898?ls=1&amp;mt=8">2048 - Flat Color Version</a>. Enjoy it!</p>

<h3 id="planning-ui">Planning UI</h3>

<p>I spent about hour of Friday evening drawing some UI in <a href="http://www.bohemiancoding.com/sketch/">Sketch</a> app.
This is I think 3rd or 4th app that has been designed in Sketch by me - it is
really great, I recommend itÂ not only for designing apps, it is also great
in quick prototyping and has many plugins hosted on GitHub. People care about
it so much - This is not an ad, just advice :)</p>

<p>The UI had to be simple, just colorful tiles on some darker background.
I think it looks nice - I am not UI/UX master, just software engineer with some
background in 2d/3d graphics :)</p>

<p><img src="/uploads/programming-blog/post-27/1.png" alt="image-1" /></p>

<h3 id="stop-and-think-a-while">Stop and think a while</h3>

<p>Thinking about UI before implementing anything related to UI is a big
thing - it is a time-saver. If you&rsquo;re planning to do some UI component or entire
screen in the app, something complex, just draw it first, play it on screen,
maybe show to someone and then when you&rsquo;re done with prototyping you can start
coding. I think I saved a lot of time by drawing UI before starting coding.
I had some experience with previous projects when I was prototyping and coding
at the same time and it took much more time than it should.</p>

<h3 id="assets">Assets</h3>

<p>I&rsquo;ve decided to export what I can to PDF files so I could work with vectors.
I recommend using PDFs - you can keep just one file of an asset instead of one
per screen scale/size. I wrote about it once in
<a href="http://szulctomasz.com/xcode-pdf-vectors-in-assets-catalog/">PDF vectors in Assets catalog</a> - go and read, I&rsquo;ll wait.</p>

<h3 id="architecture">Architecture</h3>

<p>App is targeted to iOS 8 and newer so Launch Screen was a piece of cake as well
as adding icon and implementing first screen with &ldquo;new game&rdquo; button.</p>

<p>I read a bit about <a href="https://en.wikipedia.org/wiki/Model_View_ViewModel">MVVM</a> some time ago and wanted to use it, at least to
some extent - It was more MVCVM (Model View Controller View Model). I didn&rsquo;t want
to use Reactive Cocoa and similar things, I just created and used View Models to
keep code that was responsible for processing/formatting content to be displayed
out of view controllers. The game&rsquo;s UI is simple so there are just few View Models,
but in bigger project I worked on it is working great - highly recommended.</p>

<h3 id="data-structure">Data Structure</h3>

<p>This is something I am proud of. I spoke with colleague after I finished the game
and he told me the approach is really nice. I was writing this in Swift and I
wanted to keep it really, really simple.</p>

<p>There are always 16 elements on the screen, Meaning, the board is 4 by 4 and it
has 16 slots for tiles. So I thought about the board like about matrix that has
always 16 slots and that values are appearing, disappearing and transitioning
between these slots. And I&rsquo;ve created something like 2048-data-structure for it.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">CoreGraphics</span>

<span class="kd">func</span> <span class="p">==</span> <span class="p">(</span><span class="n">lhs</span><span class="p">:</span> <span class="n">Position</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">Position</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">x</span> <span class="p">==</span> <span class="n">rhs</span><span class="p">.</span><span class="n">x</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">lhs</span><span class="p">.</span><span class="n">y</span> <span class="p">==</span> <span class="n">rhs</span><span class="p">.</span><span class="n">y</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="nc">Position</span><span class="p">:</span> <span class="nb">Equatable</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">Int</span>

    <span class="kd">var</span> <span class="nv">CGPointRepresentation</span><span class="p">:</span> <span class="n">CGPoint</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CGPointMake</span><span class="p">(</span><span class="n">CGFloat</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">Tile</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">position</span><span class="p">:</span> <span class="n">Position</span>
    <span class="kd">var</span> <span class="nv">value</span><span class="p">:</span> <span class="nb">Int</span><span class="p">?</span>

    <span class="kd">var</span> <span class="nv">upTile</span><span class="p">:</span> <span class="n">Tile</span><span class="p">?</span>
    <span class="kd">var</span> <span class="nv">rightTile</span><span class="p">:</span> <span class="n">Tile</span><span class="p">?</span>
    <span class="kd">var</span> <span class="nv">bottomTile</span><span class="p">:</span> <span class="n">Tile</span><span class="p">?</span>
    <span class="kd">var</span> <span class="nv">leftTile</span><span class="p">:</span> <span class="n">Tile</span><span class="p">?</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">position</span><span class="p">:</span> <span class="n">Position</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">Int</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">position</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">value</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Every tile has its own constant position and it always knows its neighbor tiles.
Doing this helped me a lot when I was writing logic for shifting tiles/values.</p>

<h3 id="logic-and-its-view-representation">Logic and its view representation</h3>

<p>I wanted to keep game logic out of UI. It had to be very simple class that contains
all the logic and knows only about the data structure on the board and it does not
even know what <code>UIKit</code> is. I&rsquo;ve implemented it this way that there is a class
named <code>GameLogicManager</code> which contains the whole logic and a <code>GameBoardRenderer</code>
class which is responsible for presenting the visual part of the game on screen.
It works well, at least in this case. I am wondering if this is known/popular and
good solution or not. Anyway, it fits nice to this project.</p>

<p>So, <code>GameLogicManager</code> calls delegate (<code>GameViewController</code>) and &ldquo;saying&rdquo;
<em>&ldquo;move tile from position X to Y&rdquo;</em>, <em>&ldquo;move tile from X onto Y&rdquo;</em>
(to combine with another tile) or just <em>&ldquo;game over&rdquo;</em> or <em>&ldquo;game win&rdquo;</em>.</p>

<p>Messages&rdquo; were passed to <code>GameBoardRenderer</code> which has array with <code>TileView</code>
elements and reference to <code>GameBoardView</code> and was responsible for moving
(animating) them on the screen.</p>

<p>The method that is responsible for shifting tiles on the screen took 71 lines
with comments - 56 without comments - not too long. This was the hardest thing
to implement and I wanted to keep it well commented and implemented in very simple
way. And simple it is :) It handles shifting in 4 directions as game needs.
This method was a real pain in a butt and took almost 6 hours - I&rsquo;ve tried few
approaches before I found best solution.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">shift</span><span class="p">(</span><span class="n">direction</span><span class="p">:</span> <span class="n">ShiftDirection</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Want to wait for ending one shifting before doing another which</span>
    <span class="c1">// can collide with currently performing.</span>
    <span class="k">if</span> <span class="n">updating</span> <span class="p">==</span> <span class="kc">true</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="n">updating</span> <span class="p">=</span> <span class="kc">true</span>

    <span class="kd">var</span> <span class="nv">performedShift</span> <span class="p">=</span> <span class="kc">false</span>
    <span class="k">for</span> <span class="n">rowOrColumn</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="n">boardWidth</span> <span class="p">{</span>
        <span class="c1">// Get all tiles in a row or column.</span>
        <span class="kd">var</span> <span class="nv">tilesToCheck</span> <span class="p">=</span> <span class="n">tiles</span><span class="p">.</span><span class="bp">filter</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">direction</span> <span class="p">==</span> <span class="p">.</span><span class="n">Right</span> <span class="o">||</span> <span class="n">direction</span> <span class="p">==</span> <span class="p">.</span><span class="n">Left</span><span class="p">)</span> <span class="p">?</span> <span class="nv">$0</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">:</span> <span class="nv">$0</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="p">==</span> <span class="n">rowOrColumn</span>
        <span class="p">}</span>

        <span class="c1">// When shifting right or down array need to be reversed.</span>
        <span class="k">if</span> <span class="n">direction</span> <span class="p">==</span> <span class="p">.</span><span class="n">Right</span> <span class="o">||</span> <span class="n">direction</span> <span class="p">==</span> <span class="p">.</span><span class="n">Down</span> <span class="p">{</span>
            <span class="n">tilesToCheck</span> <span class="p">=</span> <span class="bp">reverse</span><span class="p">(</span><span class="n">tilesToCheck</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nv">tileIndex</span> <span class="p">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">tileIndex</span> <span class="o">&lt;</span> <span class="n">tilesToCheck</span><span class="p">.</span><span class="bp">count</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">currentTile</span> <span class="p">=</span> <span class="n">tilesToCheck</span><span class="p">[</span><span class="n">tileIndex</span><span class="p">]</span>
            <span class="c1">// Find first tile with some value. When shifting right filter</span>
            <span class="c1">// seeks for tiles on the left, otherwise on the right from current tile.</span>
            <span class="kd">let</span> <span class="nv">filter</span><span class="p">:</span> <span class="p">((</span><span class="n">tile</span><span class="p">:</span> <span class="n">Tile</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Bool</span><span class="p">)</span> <span class="p">=</span> <span class="p">{</span> <span class="n">tile</span> <span class="k">in</span>
                <span class="kd">let</span> <span class="nv">position</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">=</span> <span class="p">{</span>
                    <span class="k">switch</span> <span class="n">direction</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="p">.</span><span class="n">Up</span><span class="p">:</span> <span class="k">return</span> <span class="n">tile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">&gt;</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span>
                    <span class="k">case</span> <span class="p">.</span><span class="n">Right</span><span class="p">:</span> <span class="k">return</span> <span class="n">tile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span>
                    <span class="k">case</span> <span class="p">.</span><span class="n">Down</span><span class="p">:</span> <span class="k">return</span> <span class="n">tile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="o">&lt;</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span>
                    <span class="k">case</span> <span class="p">.</span><span class="n">Left</span><span class="p">:</span> <span class="k">return</span> <span class="n">tile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span>
                    <span class="p">}</span>
                <span class="p">}()</span>

                <span class="k">return</span> <span class="n">position</span> <span class="p">==</span> <span class="kc">true</span> <span class="p">&amp;</span><span class="n">amp</span><span class="p">;&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">tile</span><span class="p">.</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">nil</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="kd">let</span> <span class="nv">otherTile</span> <span class="p">=</span> <span class="n">tilesToCheck</span><span class="p">.</span><span class="bp">filter</span><span class="p">(</span><span class="bp">filter</span><span class="p">).</span><span class="bp">first</span> <span class="p">{</span>
                <span class="c1">// If value is same increase value of current tile and</span>
                <span class="c1">// remove value from other tile.</span>
                <span class="k">if</span> <span class="n">otherTile</span><span class="p">.</span><span class="n">value</span> <span class="p">==</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">value</span> <span class="p">{</span>
                    <span class="n">moveOnSameTile</span><span class="p">(</span><span class="n">otherTile</span><span class="p">,</span> <span class="n">onTile</span><span class="p">:</span> <span class="n">currentTile</span><span class="p">)</span>
                    <span class="c1">// Notify about additional points because of adding up values</span>
                    <span class="n">pointCount</span> <span class="o">+=</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">value</span><span class="o">!</span>
                    <span class="c1">// If current tile get&#39;s win tile value just end the game.</span>
                    <span class="k">if</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">value</span><span class="o">!</span> <span class="p">==</span> <span class="n">winTileValue</span> <span class="p">{</span>
                        <span class="n">delegate</span><span class="p">?.</span><span class="n">gameLogicManagerDidWinGame</span><span class="p">()</span>
                        <span class="k">return</span>
                    <span class="p">}</span>
                    <span class="n">delegate</span><span class="p">?.</span><span class="n">gameLogicManagerDidCountPoints</span><span class="p">(</span><span class="n">pointCount</span><span class="p">)</span>
                    <span class="n">performedShift</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">currentTile</span><span class="p">.</span><span class="n">value</span> <span class="p">==</span> <span class="kc">nil</span> <span class="p">{</span>
                    <span class="n">moveOnEmptyTile</span><span class="p">(</span><span class="n">otherTile</span><span class="p">,</span> <span class="n">destinationTile</span><span class="p">:</span> <span class="n">currentTile</span><span class="p">)</span>
                    <span class="c1">// if tile has been moved to another place repeat this step</span>
                    <span class="c1">// because maybe next tile has the same value and they</span>
                    <span class="c1">// should be added up.</span>
                    <span class="n">tileIndex</span><span class="o">--</span>
                    <span class="n">performedShift</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">tileIndex</span><span class="o">++</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Every shift method returns boolean value if shift has been performed on</span>
    <span class="c1">// some at least one tile or not.</span>
    <span class="k">if</span> <span class="n">performedShift</span> <span class="p">{</span>
        <span class="n">delegate</span><span class="p">?.</span><span class="n">gameLogicManagerDidAddTile</span><span class="p">(</span><span class="n">addRandomTile</span><span class="p">())</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">isGameOver</span><span class="p">()</span> <span class="p">==</span> <span class="kc">true</span> <span class="p">{</span> <span class="n">delegate</span><span class="p">?.</span><span class="n">gameLogicManagerDidGameOver</span><span class="p">()</span> <span class="p">}</span>
    <span class="n">updating</span> <span class="p">=</span> <span class="kc">false</span>
<span class="p">}</span></code></pre></div>

<p>The rendering part was very simple and communication between logic manager
and renderer too - just look into repository for details. In the last three
hours I&rsquo;ve finished the &ldquo;Game Over&rdquo; / &ldquo;Game Win&rdquo; screen, storing/loading high
score and submitted the app to the Store :)</p>

<h3 id="conclusion">Conclusion</h3>

<p>I am happy to finish the game in 10 hours. I think it is pretty good time and
doing this in Swift makes me more confident about my level of understanding
the language.</p>

<p>The challenge gave me also another thoughts about how important prototyping/problem
analysis before implementation is - It could be a big time-saver - It was something
like research, right?</p>

<p>IMO I could finish the shifting method a bit faster, like about hour faster, if
I would spend 30 minutes more on thinking about the problem with paper on desk
and pen in a hand, instead of testing solutions that I had in my head without
testing them on a paper.</p>
</p>
        <footer>--<br/>2015-2018 All rights reserved. Tomasz Szulc</footer>
    </article>
        <footer></footer>
    </main>
</body>
</html>