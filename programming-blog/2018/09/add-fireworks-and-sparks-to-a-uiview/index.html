<!DOCTYPE html>
<html lang="en-us">
<head>
	<title>Add fireworks and sparks to a UIView - Tomasz Szulc</title>

	
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta name="description" content="iOS Software Engineer. Personal site, programming blog and more." />
<meta name="author" content="Tomasz Szulc" />
<meta name="keywords" content="developer, ios, programming, mobile, apps" />

	
    
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Add fireworks and sparks to a UIView" />
    <meta property="og:description" content="Let&#39;s design and implement this colorful effect of fireworks that explodes around a button." />

    
    <meta property="og:image" content="http://szulctomasz.com/uploads/programming-blog/post-54/hero.gif" />
    

    <meta property="article:published_time" content="2018-09-20 08:00:00 &#43;0000 UTC" />
    <meta property="article:tag" content="programming, ios, swift, ui" />
    
    



	
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Karla" />
<link rel="stylesheet" href="/css/style.css" />

	
<link rel="shortcut icon" type="image/jpg" href="/img/favicon.jpg"/ />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico"/ />
<link rel ="icon" type="image/jpg" href="/img/favicon.jpg"/ />

	<meta name="generator" content="Hugo 0.37.1" />

	<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-4112786-17', 'auto');
    ga('send', 'pageview');
</script>
</head>
<body>
	<main id="main-container" class= "width-default">

<div id="top-header">
    <img id="avatar" src="/img/rounded-avatar.png">
    <ul>
        <li><a href="/programming-blog">blog</a></li>
        <li><a href="/">about</a></li>
        
    </ul>
</div>
    <article>
        <h1>Add fireworks and sparks to a UIView</h1>
        <p>

<p>Do you like a little things that happens in apps you&rsquo;re using? I looked at <a href="https://dribbble.com">dribbble</a> for inspirations and found a beautiful design of onboarding process where fireworks exploded (!) around important view when user changes settings or something. I wondered how difficult it is to implement, and some time later I finished it :)</p>

<p><img src="/uploads/programming-blog/post-54/hero.gif" alt="hero" /></p>

<h2 id="fireworks-in-details">Fireworks in details</h2>

<p>Here is a detailed description of the effect. Fireworks should explode on a specific position around a view - presumably a button reacting on tap event. When it is tapped fireworks should explode close to the corners of the button and explosion should shift sparks from the explosion origin on their own trajectories.</p>

<p><img src="/uploads/programming-blog/post-54/final.jpg" alt="final" /></p>

<p><em>Love it! Makes my eyes happy and makes me want to tap the button all the time :)</em> ðŸŽ‰</p>

<p>Now let&rsquo;s take a look at the animation. Behaviour of firework as a whole is similar for every generated firework. There are also small differencies in the trajectories and scale of sparks. Let&rsquo;s break it down.</p>

<ul>
<li>There are two <em>fireworks</em> on each button tap,</li>
<li>Each of them consists of <em>8 sparks</em>,</li>
<li>Each spark follow its own <em>trajectory</em>,</li>
<li>Trajectories look <em>similar</em> but they&rsquo;re <em>not identical</em>. Few goes to the <em>right</em>, few to the <em>left</em>, others to <em>up</em> and <em>down</em> looking from the <em>explode origin</em> standpoint.</li>
</ul>

<h3 id="sparks-distribution">Sparks distribution</h3>

<p>This firework has a simple spark distribution. Two sparks on each &ldquo;view quarter&rdquo; around the explosion origin. Two sparks in the top right, bottom right, bottom left and top left quarters.</p>

<p><img src="/uploads/programming-blog/post-54/sparks-distribution.jpg" alt="sparks-distribution" /></p>

<h3 id="spark-trajectory">Spark trajectory</h3>

<p>Spark has a trajectory it is moving on. There is 8 sparks in a single firework so there is 8 trajectories needed at least. Ideally there should be more trajectories so we can random, so consecutive fireworks don&rsquo;t look exactly as previous ones.</p>

<p><img src="/uploads/programming-blog/post-54/spark-trajectories.jpg" alt="spark-trajectories" /></p>

<p>I&rsquo;ve created 4 trajectories for each quarter to add some randomness - twice more than sparks. For simplicity of calculations I normalized position of points creating trajectories. Presented trajectories differs a bit from what I finished with because I&rsquo;ve used different tool to visualize implemented trajectories - but you can get the idea :)</p>

<h2 id="implementation">Implementation</h2>

<p>Enough theory. Let&rsquo;s put all the pieces together.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="nc">SparkTrajectory</span> <span class="p">{</span>

    <span class="c1">/// Stores all points that defines a trajectory.</span>
    <span class="kd">var</span> <span class="nv">points</span><span class="p">:</span> <span class="p">[</span><span class="n">CGPoint</span><span class="p">]</span> <span class="p">{</span> <span class="kr">get</span> <span class="kr">set</span> <span class="p">}</span>

    <span class="c1">/// A path representing trajectory.</span>
    <span class="kd">var</span> <span class="nv">path</span><span class="p">:</span> <span class="n">UIBezierPath</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Here is a protocol representing spark trajectory. Sharing common interface will make it easier to create various types of trajectories. I&rsquo;ve decided to go with trajectories based on Cubic <a href="https://en.wikipedia.org/wiki/BÃ©zier_curve">BÃ©zier curve</a> and added an init method so I can make it one line call. Path of this type must consists of four points. First and last points specifies start and finish position and two middle points are points to control a curvature of a path. You can use [demos] online math tool to play with BÃ©zier curve.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="c1">/// Bezier path with two control points.</span>
<span class="kd">struct</span> <span class="nc">CubicBezierTrajectory</span><span class="p">:</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">points</span> <span class="p">=</span> <span class="p">[</span><span class="n">CGPoint</span><span class="p">]()</span>

    <span class="kd">init</span><span class="p">(</span><span class="kc">_</span> <span class="n">x0</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="kc">_</span> <span class="n">y0</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span>
         <span class="kc">_</span> <span class="n">x1</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="kc">_</span> <span class="n">y1</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span>
         <span class="kc">_</span> <span class="n">x2</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="kc">_</span> <span class="n">y2</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span>
         <span class="kc">_</span> <span class="n">x3</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">,</span> <span class="kc">_</span> <span class="n">y3</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y0</span><span class="p">))</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y1</span><span class="p">))</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y2</span><span class="p">))</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y3</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">path</span><span class="p">:</span> <span class="n">UIBezierPath</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="bp">count</span> <span class="p">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">{</span> <span class="bp">fatalError</span><span class="p">(</span><span class="s">&#34;4 points required&#34;</span><span class="p">)</span> <span class="p">}</span>

        <span class="kd">let</span> <span class="nv">path</span> <span class="p">=</span> <span class="n">UIBezierPath</span><span class="p">()</span>
        <span class="n">path</span><span class="p">.</span><span class="n">move</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">path</span><span class="p">.</span><span class="n">addCurve</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">controlPoint1</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">controlPoint2</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">path</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><img src="/uploads/programming-blog/post-54/desmos-tool.png" alt="desmos-tool" /></p>

<p>Moving on. Next thing to implement is a factory that can random a trajectory. On the drawing above you can see trajectories grouped by color. I&rsquo;ve only created top right and bottom right trajectories and mirror them. This is fine for a firework we&rsquo;re about to launch ðŸš€</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="nc">SparkTrajectoryFactory</span> <span class="p">{}</span>

<span class="kd">protocol</span> <span class="nc">ClassicSparkTrajectoryFactoryProtocol</span><span class="p">:</span> <span class="n">SparkTrajectoryFactory</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">randomTopRight</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span>
    <span class="kd">func</span> <span class="nf">randomBottomRight</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span>
<span class="p">}</span>

<span class="kr">final</span> <span class="kd">class</span> <span class="nc">ClassicSparkTrajectoryFactory</span><span class="p">:</span> <span class="n">ClassicSparkTrajectoryFactoryProtocol</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">topRight</span><span class="p">:</span> <span class="p">[</span><span class="n">SparkTrajectory</span><span class="p">]</span> <span class="p">=</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">),</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.19</span><span class="p">),</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.30</span><span class="p">),</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.45</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">}()</span>

    <span class="kd">private</span> <span class="kr">lazy</span> <span class="kd">var</span> <span class="nv">bottomRight</span><span class="p">:</span> <span class="p">[</span><span class="n">SparkTrajectory</span><span class="p">]</span> <span class="p">=</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.87</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">),</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">),</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">),</span>
            <span class="n">CubicBezierTrajectory</span><span class="p">(</span><span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">}()</span>

    <span class="kd">func</span> <span class="nf">randomTopRight</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">topRight</span><span class="p">[</span><span class="nb">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">topRight</span><span class="p">.</span><span class="bp">count</span><span class="p">)))]</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">randomBottomRight</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">bottomRight</span><span class="p">[</span><span class="nb">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">bottomRight</span><span class="p">.</span><span class="bp">count</span><span class="p">)))]</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>I&rsquo;ve named this firework a <em>classic firework</em>. Added a protocol for abstract spark trajectory factory, and a protocol for classic spark trajectory factory to be able to replace the classic factory with another factory.</p>

<p>As I mentioned before there are trajectories for two quarters I&rsquo;ve created using <a href="https://www.desmos.com/calculator/epunzldltu">desmos</a> tool, and later on we&rsquo;ll ask for a trajectory in a specific quarter top or bottom right.</p>

<p><strong>Important notice:</strong> The y-axis* values are flipped, so if desmos tool presents positive value on Y-axis you should flip it to negative because of coordinates system in iOS - lower value closer the top of the screen.</p>

<p>Also it is worth to mention that for simplicity of later calculation each trajectory starts at (0, 0).</p>

<p>We have trajectories now. Let&rsquo;s create a visual representation of a spark. Spark for classic firework will be a circle that has a color. Keeping the implementation more abstract will allow to create different spark views, e.g. with ducks images, or with pusheen cats in no time :)</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">SparkView</span><span class="p">:</span> <span class="n">UIView</span> <span class="p">{}</span>

<span class="kr">final</span> <span class="kd">class</span> <span class="nc">CircleColorSparkView</span><span class="p">:</span> <span class="n">SparkView</span> <span class="p">{</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">color</span><span class="p">:</span> <span class="n">UIColor</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">CGSize</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">CGRect</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="p">.</span><span class="n">zero</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">size</span><span class="p">))</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="p">=</span> <span class="n">color</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">cornerRadius</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="p">}</span>

    <span class="kr">required</span> <span class="kd">init</span><span class="p">?(</span><span class="n">coder</span> <span class="n">aDecoder</span><span class="p">:</span> <span class="n">NSCoder</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="kd">init</span><span class="p">(</span><span class="n">coder</span><span class="p">:</span> <span class="n">aDecoder</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">UIColor</span> <span class="p">{</span>

    <span class="kd">static</span> <span class="kd">var</span> <span class="nv">sparkColorSet1</span><span class="p">:</span> <span class="p">[</span><span class="n">UIColor</span><span class="p">]</span> <span class="p">=</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span><span class="mf">0.89</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mf">0.58</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mf">0.70</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mf">1.00</span><span class="p">),</span>
            <span class="n">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span><span class="mf">0.96</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mf">0.87</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mf">0.62</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mf">1.00</span><span class="p">),</span>
            <span class="n">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span><span class="mf">0.67</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mf">0.82</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mf">1.00</span><span class="p">),</span>
            <span class="n">UIColor</span><span class="p">(</span><span class="n">red</span><span class="p">:</span><span class="mf">0.54</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span><span class="mf">0.56</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span><span class="mf">1.00</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">}()</span>
<span class="p">}</span></code></pre></div>

<p>To create a spark view we need a factory and a data to fill a factory with. Basic data is a size of a spark and a index of a spark which defines what spark it is in a firework (for randomness).</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="nc">SparkViewFactoryData</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">size</span><span class="p">:</span> <span class="n">CGSize</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
    <span class="kd">var</span> <span class="nv">index</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">protocol</span> <span class="nc">SparkViewFactory</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">create</span><span class="p">(</span><span class="n">with</span> <span class="n">data</span><span class="p">:</span> <span class="n">SparkViewFactoryData</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkView</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">CircleColorSparkViewFactory</span><span class="p">:</span> <span class="n">SparkViewFactory</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">colors</span><span class="p">:</span> <span class="p">[</span><span class="n">UIColor</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">UIColor</span><span class="p">.</span><span class="n">sparkColorSet1</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">create</span><span class="p">(</span><span class="n">with</span> <span class="n">data</span><span class="p">:</span> <span class="n">SparkViewFactoryData</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkView</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">color</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">colors</span><span class="p">[</span><span class="n">data</span><span class="p">.</span><span class="n">index</span> <span class="o">%</span> <span class="kc">self</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="bp">count</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">CircleColorSparkView</span><span class="p">(</span><span class="n">color</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>You can see that implementation of spark that look like pusheen cat should be easy. Let&rsquo;s build a <em>classic firework</em>.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">typealias</span> <span class="n">FireworkSpark</span> <span class="p">=</span> <span class="p">(</span><span class="n">sparkView</span><span class="p">:</span> <span class="n">SparkView</span><span class="p">,</span> <span class="n">trajectory</span><span class="p">:</span> <span class="n">SparkTrajectory</span><span class="p">)</span>

<span class="kd">protocol</span> <span class="nc">Firework</span> <span class="p">{</span>

    <span class="c1">/// Defines origin of firework.</span>
    <span class="kd">var</span> <span class="nv">origin</span><span class="p">:</span> <span class="n">CGPoint</span> <span class="p">{</span> <span class="kr">get</span> <span class="kr">set</span> <span class="p">}</span>

    <span class="c1">/// Defines trajectory scale. Trajectory is normalized so it needs to be scaled up</span>
    <span class="c1">/// before presenting on screen.</span>
    <span class="kd">var</span> <span class="nv">scale</span><span class="p">:</span> <span class="n">CGFloat</span> <span class="p">{</span> <span class="kr">get</span> <span class="kr">set</span> <span class="p">}</span>

    <span class="c1">/// Defines size of a single spark.</span>
    <span class="kd">var</span> <span class="nv">sparkSize</span><span class="p">:</span> <span class="n">CGSize</span> <span class="p">{</span> <span class="kr">get</span> <span class="kr">set</span> <span class="p">}</span>

    <span class="c1">/// Returns trajectories</span>
    <span class="kd">var</span> <span class="nv">trajectoryFactory</span><span class="p">:</span> <span class="n">SparkTrajectoryFactory</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>

    <span class="c1">/// Returns spark views</span>
    <span class="kd">var</span> <span class="nv">sparkViewFactory</span><span class="p">:</span> <span class="n">SparkViewFactory</span> <span class="p">{</span> <span class="kr">get</span> <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sparkViewFactoryData</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkViewFactoryData</span>
    <span class="kd">func</span> <span class="nf">sparkView</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkView</span>
    <span class="kd">func</span> <span class="nf">trajectory</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="nc">Firework</span> <span class="p">{</span>

    <span class="c1">/// Helper method that return spark view and corresponding trajectory.</span>
    <span class="kd">func</span> <span class="nf">spark</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">FireworkSpark</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">FireworkSpark</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">sparkView</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">index</span><span class="p">),</span> <span class="kc">self</span><span class="p">.</span><span class="n">trajectory</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">index</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Here is a abstract of a firework. To instantiate a firework what it needs:</p>

<ul>
<li><em>origin</em>,</li>
<li><em>scale</em>,</li>
<li><em>sparkSize</em></li>
<li><em>trajectoryFactory</em></li>
<li><em>sparkViewFactory</em></li>
</ul>

<p>Before we go to classic implementation there is this concept of <em>scaling trajectory</em> that I didn&rsquo;t mention before. As a spark trajectory is normalized and values of their points are close to &lt;-1, 1&gt; or similar, we want them to be proper size when spark is following the path. We have to scale the path up to cover bigger part of a screen. Also, we need to be able to flip a path horizontally so we can get trajectories for a left part of a <em>classic spark</em>, and be able to shift entire path a bit in specified direction (just for randomness and better control). Here are two methods that help us achieve the goal. I believe it&rsquo;s self-explanatory.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="nc">SparkTrajectory</span> <span class="p">{</span>

    <span class="c1">/// Scales a trajectory so it fits to a UI requirements in terms of size of a trajectory.</span>
    <span class="c1">/// Use it after all other transforms have been applied and before `shift`.</span>
    <span class="kd">func</span> <span class="nf">scale</span><span class="p">(</span><span class="n">by</span> <span class="n">value</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">copy</span> <span class="p">=</span> <span class="kc">self</span>
        <span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="bp">count</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">copy</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="nv">$0</span><span class="p">].</span><span class="n">multiply</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">copy</span>
    <span class="p">}</span>

    <span class="c1">/// Flips trajectory horizontally</span>
    <span class="kd">func</span> <span class="nf">flip</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">copy</span> <span class="p">=</span> <span class="kc">self</span>
        <span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="bp">count</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">copy</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="nv">$0</span><span class="p">].</span><span class="n">x</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">copy</span>
    <span class="p">}</span>

    <span class="c1">/// Shifts a trajectory by (x, y). Applies to each point.</span>
    <span class="c1">/// Use it after all other transformations have been applied and after `scale`.</span>
    <span class="kd">func</span> <span class="nf">shift</span><span class="p">(</span><span class="n">to</span> <span class="n">point</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">copy</span> <span class="p">=</span> <span class="kc">self</span>
        <span class="kd">let</span> <span class="nv">vector</span> <span class="p">=</span> <span class="n">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
        <span class="p">(</span><span class="mf">0.</span><span class="p">.&lt;</span><span class="kc">self</span><span class="p">.</span><span class="n">points</span><span class="p">.</span><span class="bp">count</span><span class="p">).</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">copy</span><span class="p">.</span><span class="n">points</span><span class="p">[</span><span class="nv">$0</span><span class="p">].</span><span class="n">add</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">vector</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">copy</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Okay, <em>classic firework</em> then.
<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">ClassicFirework</span><span class="p">:</span> <span class="n">Firework</span> <span class="p">{</span>

    <span class="cm">/**
</span><span class="cm">     x     |     x
</span><span class="cm">        x  |   x
</span><span class="cm">           |
</span><span class="cm">     ---------------
</span><span class="cm">         x |  x
</span><span class="cm">       x   |
</span><span class="cm">           |     x
</span><span class="cm">     **/</span>

    <span class="kd">private</span> <span class="kd">struct</span> <span class="nc">FlipOptions</span><span class="p">:</span> <span class="n">OptionSet</span> <span class="p">{</span>

        <span class="kd">let</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="nb">Int</span>

        <span class="kd">static</span> <span class="kd">let</span> <span class="nv">horizontally</span> <span class="p">=</span> <span class="n">FlipOptions</span><span class="p">(</span><span class="n">rawValue</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kd">static</span> <span class="kd">let</span> <span class="nv">vertically</span> <span class="p">=</span> <span class="n">FlipOptions</span><span class="p">(</span><span class="n">rawValue</span><span class="p">:</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">enum</span> <span class="nc">Quarter</span> <span class="p">{</span>

        <span class="k">case</span> <span class="n">topRight</span>
        <span class="k">case</span> <span class="n">bottomRight</span>
        <span class="k">case</span> <span class="n">bottomLeft</span>
        <span class="k">case</span> <span class="n">topLeft</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">origin</span><span class="p">:</span> <span class="n">CGPoint</span>
    <span class="kd">var</span> <span class="nv">scale</span><span class="p">:</span> <span class="n">CGFloat</span>
    <span class="kd">var</span> <span class="nv">sparkSize</span><span class="p">:</span> <span class="n">CGSize</span>

    <span class="kd">var</span> <span class="nv">maxChangeValue</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">10</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">trajectoryFactory</span><span class="p">:</span> <span class="n">SparkTrajectoryFactory</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ClassicSparkTrajectoryFactory</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">classicTrajectoryFactory</span><span class="p">:</span> <span class="n">ClassicSparkTrajectoryFactoryProtocol</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">trajectoryFactory</span> <span class="k">as</span><span class="o">!</span> <span class="n">ClassicSparkTrajectoryFactoryProtocol</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nv">sparkViewFactory</span><span class="p">:</span> <span class="n">SparkViewFactory</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CircleColorSparkViewFactory</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">quarters</span> <span class="p">=</span> <span class="p">[</span><span class="n">Quarter</span><span class="p">]()</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">,</span> <span class="n">sparkSize</span><span class="p">:</span> <span class="n">CGSize</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">origin</span> <span class="p">=</span> <span class="n">origin</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">scale</span> <span class="p">=</span> <span class="n">scale</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">sparkSize</span> <span class="p">=</span> <span class="n">sparkSize</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">quarters</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">shuffledQuarters</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sparkViewFactoryData</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkViewFactoryData</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">DefaultSparkViewFactoryData</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">sparkSize</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">sparkView</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkView</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">sparkViewFactory</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">with</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">sparkViewFactoryData</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">index</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">trajectory</span><span class="p">(</span><span class="n">at</span> <span class="n">index</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">quarter</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">quarters</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="kd">let</span> <span class="nv">flipOptions</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">flipOptions</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="n">quarter</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">changeVector</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">randomChangeVector</span><span class="p">(</span><span class="n">flipOptions</span><span class="p">:</span> <span class="n">flipOptions</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">maxChangeValue</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">sparkOrigin</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">adding</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">changeVector</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">randomTrajectory</span><span class="p">(</span><span class="n">flipOptions</span><span class="p">:</span> <span class="n">flipOptions</span><span class="p">).</span><span class="n">scale</span><span class="p">(</span><span class="n">by</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">scale</span><span class="p">).</span><span class="n">shift</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">sparkOrigin</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">flipOptions</span><span class="p">(`</span><span class="k">for</span><span class="p">`</span> <span class="n">quarter</span><span class="p">:</span> <span class="n">Quarter</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">FlipOptions</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">flipOptions</span><span class="p">:</span> <span class="n">FlipOptions</span> <span class="p">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">quarter</span> <span class="p">==</span> <span class="p">.</span><span class="n">bottomLeft</span> <span class="o">||</span> <span class="n">quarter</span> <span class="p">==</span> <span class="p">.</span><span class="n">topLeft</span> <span class="p">{</span>
            <span class="n">flipOptions</span><span class="p">.</span><span class="bp">insert</span><span class="p">(.</span><span class="n">horizontally</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">quarter</span> <span class="p">==</span> <span class="p">.</span><span class="n">bottomLeft</span> <span class="o">||</span> <span class="n">quarter</span> <span class="p">==</span> <span class="p">.</span><span class="n">bottomRight</span> <span class="p">{</span>
            <span class="n">flipOptions</span><span class="p">.</span><span class="bp">insert</span><span class="p">(.</span><span class="n">vertically</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">flipOptions</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">shuffledQuarters</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="p">[</span><span class="n">Quarter</span><span class="p">]</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">quarters</span><span class="p">:</span> <span class="p">[</span><span class="n">Quarter</span><span class="p">]</span> <span class="p">=</span> <span class="p">[</span>
            <span class="p">.</span><span class="n">topRight</span><span class="p">,</span> <span class="p">.</span><span class="n">topRight</span><span class="p">,</span>
            <span class="p">.</span><span class="n">bottomRight</span><span class="p">,</span> <span class="p">.</span><span class="n">bottomRight</span><span class="p">,</span>
            <span class="p">.</span><span class="n">bottomLeft</span><span class="p">,</span> <span class="p">.</span><span class="n">bottomLeft</span><span class="p">,</span>
            <span class="p">.</span><span class="n">topLeft</span><span class="p">,</span> <span class="p">.</span><span class="n">topLeft</span>
        <span class="p">]</span>

        <span class="kd">var</span> <span class="nv">shuffled</span> <span class="p">=</span> <span class="p">[</span><span class="n">Quarter</span><span class="p">]()</span>
        <span class="k">for</span> <span class="kc">_</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="n">quarters</span><span class="p">.</span><span class="bp">count</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">idx</span> <span class="p">=</span> <span class="nb">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="n">quarters</span><span class="p">.</span><span class="bp">count</span><span class="p">)))</span>
            <span class="n">shuffled</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">quarters</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
            <span class="n">quarters</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">idx</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">shuffled</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">randomTrajectory</span><span class="p">(</span><span class="n">flipOptions</span><span class="p">:</span> <span class="n">FlipOptions</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">SparkTrajectory</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nv">trajectory</span><span class="p">:</span> <span class="n">SparkTrajectory</span>

        <span class="k">if</span> <span class="n">flipOptions</span><span class="p">.</span><span class="bp">contains</span><span class="p">(.</span><span class="n">vertically</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">trajectory</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">classicTrajectoryFactory</span><span class="p">.</span><span class="n">randomBottomRight</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">trajectory</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">classicTrajectoryFactory</span><span class="p">.</span><span class="n">randomTopRight</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">flipOptions</span><span class="p">.</span><span class="bp">contains</span><span class="p">(.</span><span class="n">horizontally</span><span class="p">)</span> <span class="p">?</span> <span class="n">trajectory</span><span class="p">.</span><span class="n">flip</span><span class="p">()</span> <span class="p">:</span> <span class="n">trajectory</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">randomChangeVector</span><span class="p">(</span><span class="n">flipOptions</span><span class="p">:</span> <span class="n">FlipOptions</span><span class="p">,</span> <span class="n">maxValue</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">CGVector</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">values</span> <span class="p">=</span> <span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">randomChange</span><span class="p">(</span><span class="n">maxValue</span><span class="p">),</span> <span class="kc">self</span><span class="p">.</span><span class="n">randomChange</span><span class="p">(</span><span class="n">maxValue</span><span class="p">))</span>
        <span class="kd">let</span> <span class="nv">changeX</span> <span class="p">=</span> <span class="n">flipOptions</span><span class="p">.</span><span class="bp">contains</span><span class="p">(.</span><span class="n">horizontally</span><span class="p">)</span> <span class="p">?</span> <span class="o">-</span><span class="n">values</span><span class="p">.</span><span class="mi">0</span> <span class="p">:</span> <span class="n">values</span><span class="p">.</span><span class="mi">0</span>
        <span class="kd">let</span> <span class="nv">changeY</span> <span class="p">=</span> <span class="n">flipOptions</span><span class="p">.</span><span class="bp">contains</span><span class="p">(.</span><span class="n">vertically</span><span class="p">)</span> <span class="p">?</span> <span class="n">values</span><span class="p">.</span><span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="n">values</span><span class="p">.</span><span class="mi">0</span>
        <span class="k">return</span> <span class="n">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="n">changeX</span><span class="p">,</span> <span class="n">dy</span><span class="p">:</span> <span class="n">changeY</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">randomChange</span><span class="p">(</span><span class="kc">_</span> <span class="n">maxValue</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">CGFloat</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="n">maxValue</span><span class="p">)))</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div></p>

<p>Most of the code is implementation of a <code>Firework</code> protocol so it should be easy to understand. We pass correct factories here and there and using additional enums we random a trajectory for each spark.</p>

<p>There are few methods to add some randomness in terms of origin of a firework and origin of a single spark.</p>

<p>Also there is a concept of a <em>quarter</em>. There is an array of these and it is shuffled to make sure we do not always create sparks in the same quarters in the same quantity.</p>

<p>Okay, we&rsquo;ve got the firework. How can we animate sparks then? Here comes a concept of spark animator.</p>

<p><div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="nc">SparkViewAnimator</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">animate</span><span class="p">(</span><span class="n">spark</span><span class="p">:</span> <span class="n">FireworkSpark</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="n">TimeInterval</span><span class="p">)</span>
<span class="p">}</span></code></pre></div></p>

<p>What it does it takes a spark tuple which is a spark view and its trajectory as well as animation duration. Whatever happens in the method is up to us. My implementation is quite big but it just do three things: make the spark view follow the trajectory, scales it up and down (with some randomness), and finally changes it&rsquo;s opacity. Simple. Also because of keeping this <code>SparkViewAnimator</code> abstract we can simply use different animators as we wish.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="nc">ClassicFireworkAnimator</span><span class="p">:</span> <span class="n">SparkViewAnimator</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">animate</span><span class="p">(</span><span class="n">spark</span><span class="p">:</span> <span class="n">FireworkSpark</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="n">TimeInterval</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">isHidden</span> <span class="p">=</span> <span class="kc">false</span> <span class="c1">// show previously hidden spark view</span>

        <span class="n">CATransaction</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span>

        <span class="c1">// Position</span>
        <span class="kd">let</span> <span class="nv">positionAnim</span> <span class="p">=</span> <span class="n">CAKeyframeAnimation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="s">&#34;position&#34;</span><span class="p">)</span>
        <span class="n">positionAnim</span><span class="p">.</span><span class="n">path</span> <span class="p">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">trajectory</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">cgPath</span>
        <span class="n">positionAnim</span><span class="p">.</span><span class="n">calculationMode</span> <span class="p">=</span> <span class="n">kCAAnimationLinear</span>
        <span class="n">positionAnim</span><span class="p">.</span><span class="n">rotationMode</span> <span class="p">=</span> <span class="n">kCAAnimationRotateAuto</span>
        <span class="n">positionAnim</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="n">duration</span>

        <span class="c1">// Scale</span>
        <span class="kd">let</span> <span class="nv">randomMaxScale</span> <span class="p">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="kd">let</span> <span class="nv">randomMinScale</span> <span class="p">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="o">/</span> <span class="mf">10.0</span>

        <span class="kd">let</span> <span class="nv">fromTransform</span> <span class="p">=</span> <span class="n">CATransform3DIdentity</span>
        <span class="kd">let</span> <span class="nv">byTransform</span> <span class="p">=</span> <span class="n">CATransform3DScale</span><span class="p">(</span><span class="n">fromTransform</span><span class="p">,</span> <span class="n">randomMaxScale</span><span class="p">,</span> <span class="n">randomMaxScale</span><span class="p">,</span> <span class="n">randomMaxScale</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">toTransform</span> <span class="p">=</span> <span class="n">CATransform3DScale</span><span class="p">(</span><span class="n">CATransform3DIdentity</span><span class="p">,</span> <span class="n">randomMinScale</span><span class="p">,</span> <span class="n">randomMinScale</span><span class="p">,</span> <span class="n">randomMinScale</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">transformAnim</span> <span class="p">=</span> <span class="n">CAKeyframeAnimation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="s">&#34;transform&#34;</span><span class="p">)</span>

        <span class="n">transformAnim</span><span class="p">.</span><span class="n">values</span> <span class="p">=</span> <span class="p">[</span>
            <span class="n">NSValue</span><span class="p">(</span><span class="n">caTransform3D</span><span class="p">:</span> <span class="n">fromTransform</span><span class="p">),</span>
            <span class="n">NSValue</span><span class="p">(</span><span class="n">caTransform3D</span><span class="p">:</span> <span class="n">byTransform</span><span class="p">),</span>
            <span class="n">NSValue</span><span class="p">(</span><span class="n">caTransform3D</span><span class="p">:</span> <span class="n">toTransform</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">transformAnim</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="n">duration</span>
        <span class="n">transformAnim</span><span class="p">.</span><span class="n">timingFunction</span> <span class="p">=</span> <span class="n">CAMediaTimingFunction</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">kCAMediaTimingFunctionEaseOut</span><span class="p">)</span>
        <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="n">toTransform</span>

        <span class="c1">// Opacity</span>
        <span class="kd">let</span> <span class="nv">opacityAnim</span> <span class="p">=</span> <span class="n">CAKeyframeAnimation</span><span class="p">(</span><span class="n">keyPath</span><span class="p">:</span> <span class="s">&#34;opacity&#34;</span><span class="p">)</span>
        <span class="n">opacityAnim</span><span class="p">.</span><span class="n">values</span> <span class="p">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
        <span class="n">opacityAnim</span><span class="p">.</span><span class="n">keyTimes</span> <span class="p">=</span> <span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">]</span>
        <span class="n">opacityAnim</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="n">duration</span>
        <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">opacity</span> <span class="p">=</span> <span class="mf">0.0</span>

        <span class="c1">// Group</span>
        <span class="kd">let</span> <span class="nv">groupAnimation</span> <span class="p">=</span> <span class="n">CAAnimationGroup</span><span class="p">()</span>
        <span class="n">groupAnimation</span><span class="p">.</span><span class="n">animations</span> <span class="p">=</span> <span class="p">[</span><span class="n">positionAnim</span><span class="p">,</span> <span class="n">transformAnim</span><span class="p">,</span> <span class="n">opacityAnim</span><span class="p">]</span>
        <span class="n">groupAnimation</span><span class="p">.</span><span class="n">duration</span> <span class="p">=</span> <span class="n">duration</span>

        <span class="n">CATransaction</span><span class="p">.</span><span class="n">setCompletionBlock</span><span class="p">({</span>
            <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">removeFromSuperview</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">groupAnimation</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span> <span class="s">&#34;spark-animation&#34;</span><span class="p">)</span>

        <span class="n">CATransaction</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>With the code presented we should be able to present firework on a specific view. I took it one step further and created a <code>ClassicFireworkController</code> that will manage all the work and let us make a single call to launch a firework.</p>

<p>This firework controller do one more thing. It can change a <code>zPosition</code> of a firework, so if we have a button it can launch some sparks behind and ahead of it for better look.</p>

<div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="nc">ClassicFireworkController</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nv">sparkAnimator</span><span class="p">:</span> <span class="n">SparkViewAnimator</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ClassicFireworkAnimator</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">createFirework</span><span class="p">(</span><span class="n">at</span> <span class="n">origin</span><span class="p">:</span> <span class="n">CGPoint</span><span class="p">,</span> <span class="n">sparkSize</span><span class="p">:</span> <span class="n">CGSize</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Firework</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">ClassicFirework</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span> <span class="n">sparkSize</span><span class="p">:</span> <span class="n">sparkSize</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="n">scale</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">/// It allows fireworks to explodes in close range of corners of a source view</span>
    <span class="kd">func</span> <span class="nf">addFireworks</span><span class="p">(</span><span class="bp">count</span> <span class="n">fireworksCount</span><span class="p">:</span> <span class="nb">Int</span> <span class="p">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">sparks</span> <span class="n">sparksCount</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span>
                      <span class="n">around</span> <span class="n">sourceView</span><span class="p">:</span> <span class="n">UIView</span><span class="p">,</span>
                      <span class="n">sparkSize</span><span class="p">:</span> <span class="n">CGSize</span> <span class="p">=</span> <span class="n">CGSize</span><span class="p">(</span><span class="n">width</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="mi">7</span><span class="p">),</span>
                      <span class="n">scale</span><span class="p">:</span> <span class="n">CGFloat</span> <span class="p">=</span> <span class="mf">45.0</span><span class="p">,</span>
                      <span class="n">maxVectorChange</span><span class="p">:</span> <span class="n">CGFloat</span> <span class="p">=</span> <span class="mf">15.0</span><span class="p">,</span>
                      <span class="n">animationDuration</span><span class="p">:</span> <span class="n">TimeInterval</span> <span class="p">=</span> <span class="mf">0.4</span><span class="p">,</span>
                      <span class="n">canChangeZIndex</span><span class="p">:</span> <span class="nb">Bool</span> <span class="p">=</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">superview</span> <span class="p">=</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">superview</span> <span class="k">else</span> <span class="p">{</span> <span class="bp">fatalError</span><span class="p">()</span> <span class="p">}</span>

        <span class="kd">let</span> <span class="nv">origins</span> <span class="p">=</span> <span class="p">[</span>
            <span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">minX</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">minY</span><span class="p">),</span>
            <span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">maxX</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">minY</span><span class="p">),</span>
            <span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">minX</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">maxY</span><span class="p">),</span>
            <span class="n">CGPoint</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">maxX</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">maxY</span><span class="p">),</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="kc">_</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="n">fireworksCount</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">idx</span> <span class="p">=</span> <span class="nb">Int</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="n">origins</span><span class="p">.</span><span class="bp">count</span><span class="p">)))</span>
            <span class="kd">let</span> <span class="nv">origin</span> <span class="p">=</span> <span class="n">origins</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">adding</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">randomChangeVector</span><span class="p">(</span><span class="bp">max</span><span class="p">:</span> <span class="n">maxVectorChange</span><span class="p">))</span>

            <span class="kd">let</span> <span class="nv">firework</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">createFirework</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">origin</span><span class="p">,</span> <span class="n">sparkSize</span><span class="p">:</span> <span class="n">sparkSize</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="n">scale</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">sparkIndex</span> <span class="k">in</span> <span class="mf">0.</span><span class="p">.&lt;</span><span class="n">sparksCount</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nv">spark</span> <span class="p">=</span> <span class="n">firework</span><span class="p">.</span><span class="n">spark</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">sparkIndex</span><span class="p">)</span>
                <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">isHidden</span> <span class="p">=</span> <span class="kc">true</span>
                <span class="n">superview</span><span class="p">.</span><span class="n">addSubview</span><span class="p">(</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">canChangeZIndex</span> <span class="p">{</span>
                    <span class="kd">let</span> <span class="nv">zIndexChange</span><span class="p">:</span> <span class="n">CGFloat</span> <span class="p">=</span> <span class="n">arc4random_uniform</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">+</span><span class="mi">1</span>
                    <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">zPosition</span> <span class="p">=</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">zPosition</span> <span class="o">+</span> <span class="n">zIndexChange</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">spark</span><span class="p">.</span><span class="n">sparkView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">zPosition</span> <span class="p">=</span> <span class="n">sourceView</span><span class="p">.</span><span class="n">layer</span><span class="p">.</span><span class="n">zPosition</span>
                <span class="p">}</span>

                <span class="kc">self</span><span class="p">.</span><span class="n">sparkAnimator</span><span class="p">.</span><span class="n">animate</span><span class="p">(</span><span class="n">spark</span><span class="p">:</span> <span class="n">spark</span><span class="p">,</span> <span class="n">duration</span><span class="p">:</span> <span class="n">animationDuration</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">randomChangeVector</span><span class="p">(</span><span class="bp">max</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">CGVector</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CGVector</span><span class="p">(</span><span class="n">dx</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">randomChange</span><span class="p">(</span><span class="bp">max</span><span class="p">:</span> <span class="bp">max</span><span class="p">),</span> <span class="n">dy</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">randomChange</span><span class="p">(</span><span class="bp">max</span><span class="p">:</span> <span class="bp">max</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">randomChange</span><span class="p">(</span><span class="bp">max</span><span class="p">:</span> <span class="n">CGFloat</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">CGFloat</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">CGFloat</span><span class="p">(</span><span class="n">arc4random_uniform</span><span class="p">(</span><span class="nb">UInt32</span><span class="p">(</span><span class="bp">max</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="bp">max</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>This controller does few things. It random a corner of a button to present a firework at. It adds some randomness to firework origin and create requested number of fireworks and sparks. Then it adds sparks to a source view, adjusts <code>zIndex</code> if possible and run the animator.</p>

<p>Almost all parameters have default value so you don&rsquo;t need to care about them. You can call the controller just with this:</p>

<p><div class="highlight"><pre class="chroma"><code class="language-swift" data-lang="swift"><span class="kc">self</span><span class="p">.</span><span class="n">fireworkController</span><span class="p">.</span><span class="n">addFireworks</span><span class="p">(</span><span class="bp">count</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sparks</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="n">around</span><span class="p">:</span> <span class="n">button</span><span class="p">)</span></code></pre></div></p>

<p>And voilÃ !</p>

<p><img src="/uploads/programming-blog/post-54/classic.gif" alt="classic" /></p>

<p>From this point it is easy to get a new type of firework that works like the following one. You just need to define new trajectories, create new firework and implement them to launch sparks as you wish. Putting all this code together in a controller simplifies launching fireworks wherever you want :) Or you can use a <em>fountain firework</em> I&rsquo;ve included in <a href="https://github.com/tomkowz/fireworks">tomkowz/fireworks</a> on github.</p>

<p><img src="/uploads/programming-blog/post-54/fountain.gif" alt="fountain" /></p>

<h2 id="wrap-up">Wrap up</h2>

<p>Wasn&rsquo;t easy but wasn&rsquo;t difficult too. With proper analysis of the problem (or effect in that case) we can break it down to small pieces and put it together one piece at a time. Hopefully I&rsquo;ll have a chance to use this effect in a future project ðŸŽ‰</p>

<p>That&rsquo;s it for today. Thanks for reading!</p>
</p>
        <footer>--<br/>2015-2018 All rights reserved. Tomasz Szulc</footer>
    </article>
        <footer></footer>
    </main>
</body>
</html>